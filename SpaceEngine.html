<!DOCTYPE html>
<html>
<head>
<title>SpaceEngine</title>
<script src="jquery.js"></script>
<script src="VectorSpace.js"></script>
<script src="Block.js"></script>
<script src="Surface.js"></script>
<script src="Lattice.js"></script>
<script src="Thing.js"></script>
<script src="Letters.js"></script>
</head>
<body>
<div id="canvasPanel" style="
	background: #000000;
	border: 2px solid #FF0000;
	border-radius: 10px;

">
<canvas id="graph" style="width: 100%; height: 100%;"/>
</div>
<button id="rotate">Rotate</button>
<button id="spin">Spin</button>
<p id="display">HEllo</p>
</body>
<!--LOCAL FUNCTIONS-->
<script>

	var things = [];
	var allSurfaces = [];
	
	//viewport properties
	var yob = 3;
	var XFOVangle = Math.PI / 2;
	var YFOVangle = Math.PI / 2;
	
	//for animation
	var totalTurn = 0;
	var animator;
	
	//debugging environment
	var origin = [-1, -1, -1];
	var vertices = generateBlockVertices(origin, 2, 2, 2);
	var block2 = createThing(generateBlockSurfaces(vertices, "#123456"));
	things[0] = block2;
	
	var letterCorner = [-0.75, 1.2, -0.75];
	var letterNormal = [0, 1, 0];
	var NSurfaces = letterSurfaces(letterCorner, 3 / 2, letterNormal, "F", "#FFFFFF", yob, XFOVangle, YFOVangle);
	var NLetterThing = createThing(NSurfaces);
	things[1] = NLetterThing;
	
//Events for startup
$(document).ready(function(){

	//Fit canvas size
	var c = document.getElementById("graph");
	var ctx = c.getContext("2d");
	c.width  = c.offsetWidth;
	c.height = c.offsetHeight;
	//Done fitting canvas
	
	repaint();
	
});

$(document).scroll(function(){

	alert("OK");

});

window.onscroll = function (e) {  
// called when the window is scrolled. 
	alert("OK"); 
} 

$("#rotate").click(function(){

	var origin = [0, 0, 0];
	var rotationAxis = [1, 0, 0];
	rotateEverything(origin, rotationAxis, 0.1);
	//block1 = rotateBlock(block1, origin, rotationAxis, 0.1);
	//N = rotateSurface(N, origin, rotationAxis, 0.1);
	//lattice1 = block1.vertices;
	
	repaint();
	
	$('#display').text(block1.vertices[7][1]);

});

$('#spin').click(function(){

	clearInterval(animator);
	animator = setInterval(animationRotation, 10);
	
});

function animationRotation(){
	totalTurn += 0.1;
	if (totalTurn > Math.PI / 2){
		clearInterval(animator);
		var origin = [0, 0, 0];
		var rotationAxis = [0, 0, 1];
		rotateEverything(origin, rotationAxis, 0.1);
		totalTurn = 0;
	}
	else{
		var origin = [0, 0, 0];
		var rotationAxis = [0, 0, 1];
		rotateEverything(origin, rotationAxis, 0.1);
	}
	repaint();
}

function rotateEverything(rotationAxisPoint, rotationAxisDirection, angle){
	for (var i = 0; i < things.length; i++){
		for (var j = 0; j < things[i].surfaces.length; j++){
			things[i].surfaces[j] = rotateSurface(things[i].surfaces[j], rotationAxisPoint, rotationAxisDirection, angle);
		}
	}
}

function translateEverything(translationDirection, distance){
	for (var i = 0; i < things.length; i++){
		for (var j = 0; j < things[i].surfaces.length; j++){
			things[i] = translateThing(things[i], translationDirection, direction);
		}
	}
}

function repaint(){

	//Get ready to paint
	var c = document.getElementById("graph");
	var ctx = c.getContext("2d");

	//Clear canvas
	ctx.fillStyle = "#000000";
	ctx.fillRect(0, 0, c.width, c.height);
	allSurfaces = [];
	
	//Dump all surfaces into an array, depth-sort them, then paint them starting with the background and ending with the foreground
	//DUMP
	for (var i = 0; i < things.length; i++){
		for (var j = 0; j < things[i].surfaces.length; j++){
			allSurfaces.push(things[i].surfaces[j]);
		}
	}
	
	//SORT
	var references = [];
	for (var i = 0; i < allSurfaces.length; i++){references[i] = i;}
	for (var i = 0; i < allSurfaces.length; i++){
		for (var j = i + 1; j < allSurfaces.length; j++){
			if (aIsInFrontOfB(allSurfaces[references[i]], allSurfaces[references[j]])){}
			else{
				var buffer = references[j];
				references[j] = references[i];
				references[i] = buffer;
				j = i + 1; //We want to start over now that we have a new order to proceed through the surfaces
			}
		}
	}
	
	//PAINT
	for (var i = 0; i < allSurfaces.length; i++){
		paintSurface(ctx, allSurfaces[references[allSurfaces.length - 1 - i]], yob, XFOVangle, YFOVangle);
	}
}

</script>
</html>